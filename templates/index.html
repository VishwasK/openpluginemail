<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenPlugin Demo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-shell">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <img src="{{ url_for('static', filename='images/openplugin-banner.png') }}" alt="OpenPlugin" class="brand-img">
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" data-page="email-page">
                    <span class="nav-icon">&#9993;</span>
                    <span class="nav-label">Email</span>
                </button>
                <button class="nav-item" data-page="stories-page">
                    <span class="nav-icon">&#9997;</span>
                    <span class="nav-label">Stories</span>
                </button>
                <button class="nav-item" data-page="search-page">
                    <span class="nav-icon">&#128269;</span>
                    <span class="nav-label">Web Search</span>
                </button>
                <button class="nav-item" data-page="salesforce-page">
                    <span class="nav-icon">&#9729;</span>
                    <span class="nav-label">Salesforce</span>
                </button>
                <button class="nav-item" data-page="info-page">
                    <span class="nav-icon">&#9881;</span>
                    <span class="nav-label">Info</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <div class="status-dot" id="statusIndicator"></div>
                <span id="statusText" class="status-label">Checking...</span>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <!-- ==================== EMAIL PAGE ==================== -->
            <section id="email-page" class="page active">
                <div class="page-header">
                    <h1>Email Plugin</h1>
                    <p>Send emails via SMTP</p>
                </div>

                <div class="card collapsible" id="smtpSettingsCard">
                    <div class="card-header" onclick="toggleCard('smtpSettingsCard')">
                        <h2>SMTP Settings</h2>
                        <span class="collapse-icon">&#9660;</span>
                    </div>
                    <div class="card-body">
                        <div class="mfa-info">
                            <strong>MFA Users:</strong> If your email has Multi-Factor Authentication enabled, use an <a href="https://myaccount.google.com/apppasswords" target="_blank">App Password</a> instead of your regular password.
                        </div>
                        <form id="credentialsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="smtpServer">SMTP Server *</label>
                                    <input type="text" id="smtpServer" name="smtpServer" placeholder="smtp.gmail.com" required>
                                </div>
                                <div class="form-group">
                                    <label for="smtpPort">SMTP Port *</label>
                                    <input type="number" id="smtpPort" name="smtpPort" placeholder="587" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="smtpUsername">Email/Username *</label>
                                <input type="email" id="smtpUsername" name="smtpUsername" placeholder="your-email@gmail.com" required>
                            </div>
                            <div class="form-group">
                                <label for="smtpPassword">Password/App Password *</label>
                                <input type="password" id="smtpPassword" name="smtpPassword" placeholder="App password" required>
                            </div>
                            <div class="form-group">
                                <label for="fromEmail">From Email (optional)</label>
                                <input type="email" id="fromEmail" name="fromEmail" placeholder="your-email@gmail.com">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save SMTP Credentials</button>
                                <button type="button" class="btn btn-ghost" id="clearCredentialsBtn" style="display:none;">Clear</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <h2>Compose Email</h2>
                    <form id="emailForm">
                        <div class="form-group">
                            <label for="toEmail">To *</label>
                            <input type="email" id="toEmail" name="toEmail" placeholder="recipient@example.com" required>
                        </div>
                        <div class="form-group">
                            <label for="subject">Subject *</label>
                            <input type="text" id="subject" name="subject" placeholder="Email subject" required>
                        </div>
                        <div class="form-group">
                            <label for="body">Message *</label>
                            <textarea id="body" name="body" rows="6" placeholder="Enter your message..." required></textarea>
                        </div>
                        <div class="form-group checkbox-group">
                            <label><input type="checkbox" id="isHtml" name="isHtml"> Send as HTML</label>
                        </div>
                        <button type="submit" class="btn btn-primary" id="sendBtn">
                            <span class="btn-text">Send Email</span>
                            <span class="btn-loader" style="display:none;">Sending...</span>
                        </button>
                    </form>
                    <div id="resultMessage" class="result-message" style="display:none;"></div>
                </div>
            </section>

            <!-- ==================== STORIES PAGE ==================== -->
            <section id="stories-page" class="page">
                <div class="page-header">
                    <h1>Story Plugin</h1>
                    <p>Write, continue, and improve stories with AI</p>
                </div>

                <div class="card collapsible" id="openaiSettingsCard">
                    <div class="card-header" onclick="toggleCard('openaiSettingsCard')">
                        <h2>OpenAI Settings</h2>
                        <span class="collapse-icon">&#9660;</span>
                    </div>
                    <div class="card-body">
                        <form id="openaiCredentialsForm">
                            <div class="form-group">
                                <label for="openaiApiKey">API Key *</label>
                                <div style="position:relative;">
                                    <input type="password" id="openaiApiKey" name="openaiApiKey" placeholder="sk-..." required autocomplete="off" style="padding-right:48px;">
                                    <button type="button" class="toggle-password-btn" onclick="togglePasswordVisibility('openaiApiKey', this)" title="Show/Hide">&#128065;</button>
                                </div>
                                <small class="help-text">Get your key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>. Stored locally in your browser.</small>
                            </div>
                            <div class="form-group">
                                <label for="openaiModel">Model</label>
                                <select id="openaiModel" name="openaiModel">
                                    <option value="gpt-5-nano" selected>GPT-5 Nano</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save OpenAI Key</button>
                                <button type="button" class="btn btn-ghost" id="clearOpenAIBtn" style="display:none;">Clear</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="story-tabs">
                    <button class="story-tab active" data-story="write">Write</button>
                    <button class="story-tab" data-story="continue">Continue</button>
                    <button class="story-tab" data-story="improve">Improve</button>
                </div>

                <div id="story-write" class="story-panel active">
                    <div class="card">
                        <h2>Write a New Story</h2>
                        <form id="storyForm">
                            <div class="form-group">
                                <label for="storyPrompt">Story Prompt *</label>
                                <textarea id="storyPrompt" name="storyPrompt" rows="4" placeholder="Write a fantasy story about a young wizard discovering their powers..." required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="storyGenre">Genre</label>
                                    <input type="text" id="storyGenre" name="storyGenre" placeholder="fantasy, sci-fi, mystery...">
                                </div>
                                <div class="form-group">
                                    <label for="storyLength">Length</label>
                                    <select id="storyLength" name="storyLength">
                                        <option value="short">Short</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="long">Long</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="storyTone">Tone</label>
                                <input type="text" id="storyTone" name="storyTone" placeholder="funny, serious, dark, adventurous...">
                            </div>
                            <button type="submit" class="btn btn-primary" id="writeStoryBtn">
                                <span class="btn-text">Write Story</span>
                                <span class="btn-loader" style="display:none;">Writing...</span>
                            </button>
                        </form>
                        <div id="storyResult" class="story-result" style="display:none;"></div>
                    </div>
                </div>

                <div id="story-continue" class="story-panel">
                    <div class="card">
                        <h2>Continue a Story</h2>
                        <form id="continueStoryForm">
                            <div class="form-group">
                                <label for="continueStoryText">Existing Story *</label>
                                <textarea id="continueStoryText" name="continueStoryText" rows="6" placeholder="Paste your existing story here..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="continueDirection">Direction</label>
                                <input type="text" id="continueDirection" name="continueDirection" placeholder="Add a plot twist, introduce a new character...">
                            </div>
                            <div class="form-group">
                                <label for="continueLength">Length</label>
                                <select id="continueLength" name="continueLength">
                                    <option value="short">Short</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="long">Long</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" id="continueStoryBtn">
                                <span class="btn-text">Continue Story</span>
                                <span class="btn-loader" style="display:none;">Continuing...</span>
                            </button>
                        </form>
                        <div id="continueResult" class="story-result" style="display:none;"></div>
                    </div>
                </div>

                <div id="story-improve" class="story-panel">
                    <div class="card">
                        <h2>Improve a Story</h2>
                        <form id="improveStoryForm">
                            <div class="form-group">
                                <label for="improveStoryText">Story to Improve *</label>
                                <textarea id="improveStoryText" name="improveStoryText" rows="6" placeholder="Paste your story here..." required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="improveFocus">Focus</label>
                                    <input type="text" id="improveFocus" name="improveFocus" placeholder="dialogue, descriptions, pacing...">
                                </div>
                                <div class="form-group">
                                    <label for="improveStyle">Style</label>
                                    <input type="text" id="improveStyle" name="improveStyle" placeholder="literary, casual, poetic...">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="improveStoryBtn">
                                <span class="btn-text">Improve Story</span>
                                <span class="btn-loader" style="display:none;">Improving...</span>
                            </button>
                        </form>
                        <div id="improveResult" class="story-result" style="display:none;"></div>
                    </div>
                </div>
            </section>

            <!-- ==================== SEARCH PAGE ==================== -->
            <section id="search-page" class="page">
                <div class="page-header">
                    <h1>Web Search Plugin</h1>
                    <p>Search the web and summarize results with AI</p>
                </div>

                <div class="card">
                    <h2>Web Search</h2>
                    <form id="webSearchForm">
                        <div class="form-group">
                            <label for="searchQuery">Search Query *</label>
                            <input type="text" id="searchQuery" name="searchQuery" placeholder="Enter your search query..." required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="searchResults">Results</label>
                                <select id="searchResults" name="searchResults">
                                    <option value="3">3</option>
                                    <option value="5" selected>5</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="searchRegion">Region</label>
                                <select id="searchRegion" name="searchRegion">
                                    <option value="us-en" selected>US English</option>
                                    <option value="uk-en">UK English</option>
                                    <option value="es-es">Spanish</option>
                                    <option value="fr-fr">French</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="webSearchBtn">
                            <span class="btn-text">Search</span>
                            <span class="btn-loader" style="display:none;">Searching...</span>
                        </button>
                    </form>
                    <div id="webSearchResult" class="story-result" style="display:none;"></div>
                </div>

                <div class="card">
                    <h2>Search &amp; Summarize</h2>
                    <form id="searchSummarizeForm">
                        <div class="form-group">
                            <label for="summarizeQuery">Question *</label>
                            <input type="text" id="summarizeQuery" name="summarizeQuery" placeholder="What are the latest features in Python 3.12?" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="summarizeResults">Sources</label>
                                <select id="summarizeResults" name="summarizeResults">
                                    <option value="3">3</option>
                                    <option value="5" selected>5</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="summarizeFocus">Focus</label>
                                <input type="text" id="summarizeFocus" name="summarizeFocus" placeholder="new features, improvements...">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="searchSummarizeBtn">
                            <span class="btn-text">Search &amp; Summarize</span>
                            <span class="btn-loader" style="display:none;">Summarizing...</span>
                        </button>
                    </form>
                    <div id="searchSummarizeResult" class="story-result" style="display:none;"></div>
                </div>
            </section>

            <!-- ==================== SALESFORCE PAGE ==================== -->
            <section id="salesforce-page" class="page">
                <div class="page-header">
                    <h1>Salesforce Plugin</h1>
                    <p>Query, create, and update Salesforce records</p>
                </div>

                <div class="card" id="sfConnectCard">
                    <h2>Connection</h2>
                    <div id="sfConnectedBanner" style="display:none;" class="connected-banner">
                        <span class="connected-dot"></span>
                        <strong>Connected to Salesforce</strong>
                        <span id="sfInstanceDisplay" class="instance-url"></span>
                        <button type="button" class="btn btn-ghost btn-sm" id="sfDisconnectBtn">Disconnect</button>
                    </div>
                    <form id="salesforceCredentialsForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sfClientId">Client ID (Consumer Key) *</label>
                                <input type="text" id="sfClientId" name="sfClientId" placeholder="Consumer Key" required>
                            </div>
                            <div class="form-group">
                                <label for="sfClientSecret">Client Secret *</label>
                                <input type="password" id="sfClientSecret" name="sfClientSecret" placeholder="Consumer Secret" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sfDomain">Domain</label>
                            <select id="sfDomain" name="sfDomain">
                                <option value="login" selected>Production</option>
                                <option value="test">Sandbox</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="sfConnectBtn">Connect to Salesforce</button>
                        </div>
                        <div id="salesforceConnectionStatus" style="margin-top:15px;display:none;"></div>
                    </form>
                </div>

                <div class="card">
                    <h2>SOQL Query</h2>
                    <form id="salesforceQueryForm">
                        <div class="form-group">
                            <label for="soqlQuery">Query *</label>
                            <textarea id="soqlQuery" name="soqlQuery" rows="3" placeholder="SELECT Id, Name, Industry FROM Account LIMIT 10" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="salesforceQueryBtn">
                            <span class="btn-text">Execute Query</span>
                            <span class="btn-loader" style="display:none;">Querying...</span>
                        </button>
                    </form>
                    <div id="salesforceQueryResult" class="story-result" style="display:none;"></div>
                </div>

                <div class="two-col">
                    <div class="card">
                        <h2>Create Record</h2>
                        <form id="salesforceCreateForm">
                            <div class="form-group">
                                <label for="createObjectType">Object Type *</label>
                                <input type="text" id="createObjectType" name="createObjectType" placeholder="Account, Contact..." required>
                            </div>
                            <div class="form-group">
                                <label for="createFields">Fields (JSON) *</label>
                                <textarea id="createFields" name="createFields" rows="4" placeholder='{"Name": "Acme Corp", "Industry": "Technology"}' required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary" id="salesforceCreateBtn">
                                <span class="btn-text">Create</span>
                                <span class="btn-loader" style="display:none;">Creating...</span>
                            </button>
                        </form>
                        <div id="salesforceCreateResult" class="story-result" style="display:none;"></div>
                    </div>

                    <div class="card">
                        <h2>Update Record</h2>
                        <form id="salesforceUpdateForm">
                            <div class="form-group">
                                <label for="updateObjectType">Object Type *</label>
                                <input type="text" id="updateObjectType" name="updateObjectType" placeholder="Account" required>
                            </div>
                            <div class="form-group">
                                <label for="updateRecordId">Record ID *</label>
                                <input type="text" id="updateRecordId" name="updateRecordId" placeholder="001xx000003DGbQ" required>
                            </div>
                            <div class="form-group">
                                <label for="updateFields">Fields (JSON) *</label>
                                <textarea id="updateFields" name="updateFields" rows="3" placeholder='{"Industry": "Technology"}' required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary" id="salesforceUpdateBtn">
                                <span class="btn-text">Update</span>
                                <span class="btn-loader" style="display:none;">Updating...</span>
                            </button>
                        </form>
                        <div id="salesforceUpdateResult" class="story-result" style="display:none;"></div>
                    </div>
                </div>

                <div class="card">
                    <h2>Agentforce Action</h2>
                    <form id="salesforceActionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="actionName">Action Name *</label>
                                <input type="text" id="actionName" name="actionName" placeholder="CreateAccount" required>
                            </div>
                            <div class="form-group">
                                <label for="actionRecordId">Record ID</label>
                                <input type="text" id="actionRecordId" name="actionRecordId" placeholder="Optional">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="actionParams">Parameters (JSON)</label>
                            <textarea id="actionParams" name="actionParams" rows="3" placeholder='{"name": "Acme Corp"}'></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="salesforceActionBtn">
                            <span class="btn-text">Execute Action</span>
                            <span class="btn-loader" style="display:none;">Executing...</span>
                        </button>
                    </form>
                    <div id="salesforceActionResult" class="story-result" style="display:none;"></div>
                </div>
            </section>

            <!-- ==================== INFO PAGE ==================== -->
            <section id="info-page" class="page">
                <div class="page-header">
                    <h1>Plugin Information</h1>
                    <p>API endpoints and framework details</p>
                </div>

                <div class="card">
                    <h2>About</h2>
                    <p style="margin-bottom:16px;">This is an example implementation of the <a href="https://github.com/VishwasK/openplugin" target="_blank"><strong>OpenPlugin Framework</strong></a> -- a vendor-agnostic LLM plugin framework. Build once, run anywhere.</p>
                    <img src="{{ url_for('static', filename='images/openplugin-banner.png') }}" alt="OpenPlugin - Build Once, Run Anywhere" style="width:100%;border-radius:8px;margin-bottom:16px;">
                </div>

                <div class="card">
                    <h2>Plugin Info</h2>
                    <div id="pluginInfo" class="plugin-info"><p>Loading...</p></div>
                </div>

                <div class="card">
                    <h2>API Endpoints</h2>
                    <div class="endpoints-list">
                        <div class="endpoint"><span class="method get">GET</span><code>/</code><span class="ep-desc">Health check</span></div>
                        <div class="endpoint"><span class="method post">POST</span><code>/api/email/send</code><span class="ep-desc">Send email</span></div>
                        <div class="endpoint"><span class="method post">POST</span><code>/api/story/write</code><span class="ep-desc">Write story</span></div>
                        <div class="endpoint"><span class="method post">POST</span><code>/api/salesforce/query</code><span class="ep-desc">SOQL query</span></div>
                        <div class="endpoint"><span class="method post">POST</span><code>/api/salesforce/create</code><span class="ep-desc">Create record</span></div>
                        <div class="endpoint"><span class="method post">POST</span><code>/api/salesforce/update</code><span class="ep-desc">Update record</span></div>
                        <div class="endpoint"><span class="method post">POST</span><code>/api/salesforce/authorize</code><span class="ep-desc">OAuth authorize</span></div>
                        <div class="endpoint"><span class="method get">GET</span><code>/callback</code><span class="ep-desc">OAuth callback</span></div>
                        <div class="endpoint"><span class="method get">GET</span><code>/api/openplugin/manifest</code><span class="ep-desc">Plugin manifest</span></div>
                    </div>
                </div>

                <div class="card">
                    <h2>Links</h2>
                    <ul style="list-style:none;padding:0;">
                        <li style="margin-bottom:8px;"><a href="https://github.com/VishwasK/openplugin" target="_blank">OpenPlugin Framework (GitHub)</a></li>
                        <li style="margin-bottom:8px;"><a href="https://github.com/VishwasK/openpluginemail" target="_blank">This Demo App (GitHub)</a></li>
                    </ul>
                </div>
            </section>
        </main>
    </div>

    <script>
    // Page navigation
    document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(btn.dataset.page).classList.add('active');
        });
    });

    // Story sub-tabs
    document.querySelectorAll('.story-tab').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.story-tab').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.story-panel').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('story-' + btn.dataset.story).classList.add('active');
        });
    });

    // Collapsible cards
    function toggleCard(id) {
        document.getElementById(id).classList.toggle('collapsed');
    }

    // Handle hash-based deep linking (e.g. /#salesforce after OAuth callback)
    function handleHash() {
        const map = { salesforce: 'salesforce-page', email: 'email-page', stories: 'stories-page', search: 'search-page', info: 'info-page' };
        const hash = window.location.hash.replace('#', '');
        const pageId = map[hash];
        if (pageId) {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const navBtn = document.querySelector(`.nav-item[data-page="${pageId}"]`);
            if (navBtn) navBtn.classList.add('active');
            document.getElementById(pageId).classList.add('active');
        }
    }
    handleHash();
    window.addEventListener('hashchange', handleHash);
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
